# 项目结构
我的项目结构如下
-web_app.py
-baidu_api.py
-qps_manner.py
-baidu_api_imp.py
我web_app调用baidu_api_imp中的函数提供服务，而baidu_api_imp调用baidu_api中的函数发送获取http请求的数据，而baidu_api则调用qps_manner中的fetch函数，fetch发送http请求并处理异常最后返回数据给baidu_api,现在在百度qps限制下，为了加快http请求速度，我申请了多个百度ak并希望他们异步或者多线程发送请求，最后汇总结果，我该如何设计

# QPS限制

http请求有着严格的qps/并发限制，如果不考虑限制发送请求，在实现了重试机制的情况下也会浪费大量配额在重试上，为了正确获取全部信息同时尽可能不浪费配额，我们需要严格限制后端的调用api时的qps。我们采用时间窗口的方式限制qps.

## 时间日志

## 算法流程

我们将时间话按照单位时间h划分,每个时间窗口只接受并处理最多固定数量的请求，如果数量达到限制，下一个请求就会进入等待，直到下一个时间节点，重复上述过程，在这其中，，为了避免固定时间窗口存在的临界问题，可以通过记录每个请求开始的时间戳，将最先窗口内第一个请求的的时间戳作为窗口的开始时间，每次加入请求前判断是否超过qps即可，形成一种动态窗口。

## 优点

相较于经典的固定窗口限流算法，这样可以避免临界问题，而相较于滑动窗口的细化时间窗的方式节省了空间。

## 优化策略

由于在同一个模块也会需要发布多个http请求，以构图时的批量算路的请求，我们可能要消耗50000到340000的额度，可能需要10000到110000次请求，如果在qps为3的限制下会超过50分钟

### 1.多线程异步优化

我们在原模式下时串行实现，在两个请求发出的间隔时间内，有着请求的
